# 手机端远程控制 + 桌面查看 - 任务规划

## 项目概述

**目标**：实现从手机端控制桌面 AI 编程助手，并支持查看电脑桌面屏幕。

**参考项目**：Happy (https://github.com/slopus/happy)

**技术栈**：
- 桌面端：Go + Wails（现有架构）
- 中继服务器：Go + Gorilla WebSocket
- 手机端：Vue.js PWA
- 屏幕共享：截图流（github.com/kbinani/screenshot）

## 任务分解

### 阶段 1：技术验证（1 周）

#### TASK-1.1：屏幕截图功能验证
**状态**：pending  
**优先级**：高  
**预计时间**：2 天

**目标**：验证跨平台屏幕截图功能是否可行

**子任务**：
- [ ] 1.1.1 安装 `github.com/kbinani/screenshot` 库
- [ ] 1.1.2 创建 `screen_capture_test.go` 测试文件
- [ ] 1.1.3 实现基础截图功能
- [ ] 1.1.4 测试 JPEG 压缩和质量调整
- [ ] 1.1.5 测试不同分辨率下的性能
- [ ] 1.1.6 验证 macOS/Windows/Linux 兼容性

**验证标准**：
- ✅ 能成功截取屏幕
- ✅ JPEG 压缩后大小在 100-300 KB 范围
- ✅ 截图耗时 < 100ms
- ✅ 至少在 2 个平台上测试通过

**输出**：
- `myapp/screen_capture_test.go` - 测试代码
- 测试报告（截图大小、耗时、兼容性）

---

#### TASK-1.2：WebSocket 通信验证
**状态**：pending  
**优先级**：高  
**预计时间**：2 天

**目标**：验证 WebSocket 双向通信和消息加密

**子任务**：
- [ ] 1.2.1 创建简单的 WebSocket 服务器
- [ ] 1.2.2 创建 WebSocket 客户端（桌面端）
- [ ] 1.2.3 实现消息加密/解密（AES-256-GCM）
- [ ] 1.2.4 测试大数据传输（截图数据）
- [ ] 1.2.5 测试断线重连机制

**验证标准**：
- ✅ 能建立 WebSocket 连接
- ✅ 能发送/接收加密消息
- ✅ 能传输 300 KB 的截图数据
- ✅ 断线后能自动重连

**输出**：
- `myapp/websocket_test.go` - 测试代码
- 性能测试报告

---

#### TASK-1.3：Ngrok 快速原型
**状态**：pending  
**优先级**：中  
**预计时间**：1 天

**目标**：使用 Ngrok 快速验证远程访问可行性

**子任务**：
- [ ] 1.3.1 安装 Ngrok
- [ ] 1.3.2 创建本地 HTTP 服务器
- [ ] 1.3.3 通过 Ngrok 暴露服务
- [ ] 1.3.4 从手机浏览器访问测试

**验证标准**：
- ✅ 能从手机访问桌面端服务
- ✅ 延迟 < 2 秒

**输出**：
- 可行性报告

---

### 阶段 2：桌面端实现（2 周）

#### TASK-2.1：屏幕截图模块
**状态**：pending  
**优先级**：高  
**预计时间**：3 天

**目标**：实现完整的屏幕截图管理器

**子任务**：
- [ ] 2.1.1 创建 `myapp/screen_capture.go`
- [ ] 2.1.2 实现 `ScreenCaptureManager` 结构
- [ ] 2.1.3 实现定期截图功能
- [ ] 2.1.4 实现质量/间隔/显示器选择
- [ ] 2.1.5 实现自适应质量调整
- [ ] 2.1.6 编写单元测试

**验证标准**：
- ✅ 代码编译通过
- ✅ 单元测试覆盖率 > 80%
- ✅ 能定期截图并回调
- ✅ 能动态调整参数

**输出**：
- `myapp/screen_capture.go` - 实现代码
- `myapp/screen_capture_test.go` - 测试代码

---

#### TASK-2.2：远程控制管理器
**状态**：pending  
**优先级**：高  
**预计时间**：4 天

**目标**：实现远程控制核心逻辑

**子任务**：
- [ ] 2.2.1 创建 `myapp/remote_control.go`
- [ ] 2.2.2 实现 `RemoteControlManager` 结构
- [ ] 2.2.3 实现连接码生成和验证
- [ ] 2.2.4 实现 WebSocket 客户端
- [ ] 2.2.5 实现消息加密/解密
- [ ] 2.2.6 集成屏幕截图功能
- [ ] 2.2.7 实现会话管理（启动/停止/状态）
- [ ] 2.2.8 编写单元测试

**验证标准**：
- ✅ 代码编译通过
- ✅ 能生成 6 位连接码
- ✅ 能连接到中继服务器
- ✅ 能发送加密的截图数据
- ✅ 单元测试通过

**输出**：
- `myapp/remote_control.go` - 实现代码
- `myapp/remote_control_test.go` - 测试代码

---

#### TASK-2.3：App API 集成
**状态**：pending  
**优先级**：高  
**预计时间**：2 天

**目标**：在 App 中暴露远程控制 API

**子任务**：
- [ ] 2.3.1 在 `app.go` 中添加 `remoteMgr` 字段
- [ ] 2.3.2 实现 `StartRemoteSession()` API
- [ ] 2.3.3 实现 `StopRemoteSession()` API
- [ ] 2.3.4 实现 `GetRemoteSessionInfo()` API
- [ ] 2.3.5 实现屏幕共享相关 API
- [ ] 2.3.6 更新 Wails 绑定

**验证标准**：
- ✅ 代码编译通过
- ✅ `wails generate` 成功
- ✅ 前端能调用所有 API

**输出**：
- 更新的 `myapp/app.go`
- 更新的 Wails 绑定文件

---

#### TASK-2.4：前端 UI 实现
**状态**：pending  
**优先级**：中  
**预计时间**：2 天

**目标**：在设置面板添加远程控制界面

**子任务**：
- [ ] 2.4.1 在 `SettingsPanel.vue` 添加"远程控制"标签
- [ ] 2.4.2 实现连接码显示界面
- [ ] 2.4.3 实现二维码生成（可选）
- [ ] 2.4.4 实现屏幕共享设置（质量/间隔/显示器）
- [ ] 2.4.5 实现会话状态显示
- [ ] 2.4.6 实现启动/停止按钮

**验证标准**：
- ✅ UI 正常显示
- ✅ 能启动/停止远程会话
- ✅ 能显示连接码
- ✅ 能调整屏幕共享参数

**输出**：
- 更新的 `myapp/frontend/src/components/SettingsPanel.vue`

---

### 阶段 3：中继服务器（1 周）

#### TASK-3.1：基础服务器实现
**状态**：pending  
**优先级**：高  
**预计时间**：3 天

**目标**：实现中继服务器核心功能

**子任务**：
- [ ] 3.1.1 创建新项目 `kiro-relay-server`
- [ ] 3.1.2 实现 WebSocket 服务器
- [ ] 3.1.3 实现会话配对逻辑
- [ ] 3.1.4 实现消息转发
- [ ] 3.1.5 实现会话超时管理
- [ ] 3.1.6 实现连接码验证
- [ ] 3.1.7 添加日志记录

**验证标准**：
- ✅ 服务器能启动
- ✅ 能接受 WebSocket 连接
- ✅ 能配对桌面端和手机端
- ✅ 能转发消息

**输出**：
- `kiro-relay-server/` - 新项目目录
- `kiro-relay-server/main.go` - 服务器代码
- `kiro-relay-server/README.md` - 部署文档

---

#### TASK-3.2：部署和测试
**状态**：pending  
**优先级**：中  
**预计时间**：2 天

**目标**：部署服务器并进行集成测试

**子任务**：
- [ ] 3.2.1 编写 Dockerfile
- [ ] 3.2.2 部署到云服务器（Railway/Render）
- [ ] 3.2.3 配置 HTTPS（Let's Encrypt）
- [ ] 3.2.4 进行端到端测试
- [ ] 3.2.5 性能测试（并发连接数）

**验证标准**：
- ✅ 服务器在线运行
- ✅ 支持 HTTPS
- ✅ 能处理 100+ 并发连接
- ✅ 桌面端能连接成功

**输出**：
- 部署文档
- 性能测试报告

---

### 阶段 4：手机端 PWA（2 周）

#### TASK-4.1：项目搭建
**状态**：pending  
**优先级**：高  
**预计时间**：1 天

**目标**：创建 Vue.js PWA 项目

**子任务**：
- [ ] 4.1.1 使用 Vite 创建 Vue 项目
- [ ] 4.1.2 配置 PWA 插件
- [ ] 4.1.3 配置响应式设计
- [ ] 4.1.4 配置路由
- [ ] 4.1.5 配置状态管理（Pinia）

**验证标准**：
- ✅ 项目能启动
- ✅ 能在手机浏览器访问
- ✅ 能添加到主屏幕

**输出**：
- `kiro-mobile/` - 新项目目录

---

#### TASK-4.2：连接功能
**状态**：pending  
**优先级**：高  
**预计时间**：2 天

**目标**：实现连接码输入和配对

**子任务**：
- [ ] 4.2.1 创建连接页面
- [ ] 4.2.2 实现 6 位码输入组件
- [ ] 4.2.3 实现二维码扫描（可选）
- [ ] 4.2.4 实现 WebSocket 连接
- [ ] 4.2.5 实现消息加密/解密
- [ ] 4.2.6 实现连接状态管理

**验证标准**：
- ✅ 能输入连接码
- ✅ 能连接到中继服务器
- ✅ 能与桌面端配对成功

**输出**：
- `kiro-mobile/src/views/Connect.vue`
- `kiro-mobile/src/composables/useWebSocket.js`

---

#### TASK-4.3：桌面查看功能
**状态**：pending  
**优先级**：高  
**预计时间**：3 天

**目标**：实现屏幕查看界面

**子任务**：
- [ ] 4.3.1 创建 `ScreenViewer.vue` 组件
- [ ] 4.3.2 实现图片显示和自适应
- [ ] 4.3.3 实现质量/间隔切换
- [ ] 4.3.4 实现全屏查看
- [ ] 4.3.5 实现手势缩放（可选）
- [ ] 4.3.6 优化加载和缓存

**验证标准**：
- ✅ 能显示桌面截图
- ✅ 能切换质量和间隔
- ✅ 能全屏查看
- ✅ 加载流畅，无卡顿

**输出**：
- `kiro-mobile/src/components/ScreenViewer.vue`

---

#### TASK-4.4：聊天功能
**状态**：pending  
**优先级**：中  
**预计时间**：3 天

**目标**：实现聊天界面

**子任务**：
- [ ] 4.4.1 创建 `ChatPanel.vue` 组件
- [ ] 4.4.2 实现消息列表显示
- [ ] 4.4.3 实现消息输入
- [ ] 4.4.4 实现消息发送/接收
- [ ] 4.4.5 实现 Markdown 渲染
- [ ] 4.4.6 实现代码高亮

**验证标准**：
- ✅ 能发送消息到桌面端
- ✅ 能接收桌面端回复
- ✅ Markdown 正常渲染
- ✅ 代码高亮正常

**输出**：
- `kiro-mobile/src/components/ChatPanel.vue`

---

#### TASK-4.5：文件浏览功能
**状态**：pending  
**优先级**：低  
**预计时间**：2 天

**目标**：实现文件浏览器

**子任务**：
- [ ] 4.5.1 创建 `FileExplorer.vue` 组件
- [ ] 4.5.2 实现文件树显示
- [ ] 4.5.3 实现文件内容查看
- [ ] 4.5.4 实现代码高亮

**验证标准**：
- ✅ 能浏览项目文件
- ✅ 能查看文件内容

**输出**：
- `kiro-mobile/src/components/FileExplorer.vue`

---

### 阶段 5：集成测试和优化（1 周）

#### TASK-5.1：端到端测试
**状态**：pending  
**优先级**：高  
**预计时间**：3 天

**目标**：完整的功能测试

**子任务**：
- [ ] 5.1.1 测试连接流程
- [ ] 5.1.2 测试屏幕共享
- [ ] 5.1.3 测试聊天功能
- [ ] 5.1.4 测试断线重连
- [ ] 5.1.5 测试多设备连接
- [ ] 5.1.6 测试不同网络环境

**验证标准**：
- ✅ 所有功能正常工作
- ✅ 无明显 bug
- ✅ 在 WiFi/4G/3G 下都能使用

**输出**：
- 测试报告

---

#### TASK-5.2：性能优化
**状态**：pending  
**优先级**：中  
**预计时间**：2 天

**目标**：优化性能和用户体验

**子任务**：
- [ ] 5.2.1 优化截图压缩算法
- [ ] 5.2.2 实现自适应质量
- [ ] 5.2.3 优化 WebSocket 消息大小
- [ ] 5.2.4 优化手机端渲染性能
- [ ] 5.2.5 添加加载动画和反馈

**验证标准**：
- ✅ 截图延迟 < 2 秒
- ✅ 手机端流畅运行
- ✅ 带宽占用合理

**输出**：
- 性能优化报告

---

#### TASK-5.3：文档编写
**状态**：pending  
**优先级**：中  
**预计时间**：2 天

**目标**：编写用户文档和开发文档

**子任务**：
- [ ] 5.3.1 编写用户使用指南
- [ ] 5.3.2 编写部署文档
- [ ] 5.3.3 编写 API 文档
- [ ] 5.3.4 录制演示视频

**验证标准**：
- ✅ 文档完整清晰
- ✅ 有截图和示例

**输出**：
- `docs/USER_GUIDE.md`
- `docs/DEPLOYMENT.md`
- `docs/API.md`

---

## 时间估算

| 阶段 | 预计时间 | 任务数 |
|------|---------|--------|
| 阶段 1：技术验证 | 1 周 | 3 |
| 阶段 2：桌面端实现 | 2 周 | 4 |
| 阶段 3：中继服务器 | 1 周 | 2 |
| 阶段 4：手机端 PWA | 2 周 | 5 |
| 阶段 5：集成测试和优化 | 1 周 | 3 |
| **总计** | **7 周** | **17** |

## 风险和依赖

### 技术风险
- 屏幕截图库可能在某些平台不兼容
- WebSocket 在移动网络下可能不稳定
- 加密可能影响性能

### 依赖关系
- TASK-2.2 依赖 TASK-2.1
- TASK-2.3 依赖 TASK-2.2
- TASK-2.4 依赖 TASK-2.3
- TASK-4.2 依赖 TASK-3.1
- TASK-4.3 依赖 TASK-4.2
- 阶段 5 依赖阶段 1-4 全部完成

## 下一步行动

1. ✅ 创建任务规划文档（当前文档）
2. ⏭️ 开始 TASK-1.1：屏幕截图功能验证
3. ⏭️ 等待用户确认计划

## 变更记录

| 日期 | 变更内容 | 原因 |
|------|---------|------|
| 2026-01-21 | 创建初始计划 | 项目启动 |
