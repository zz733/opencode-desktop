# 代码结构说明

## 当前模块组织

### 已拆分的模块
- `main.go` (1.7K) - 应用入口
- `provider.go` (61 行) - Provider 和配置管理
- `model.go` (123 行) - 模型配置管理
- `session.go` (541 行) - 会话管理（Session, Message, 图片处理, SSE 订阅）
- `plugin.go` (497 行) - 插件管理（OhMyOpenCode, AntigravityAuth）
- `mcp.go` (618 行) - MCP 服务器管理（配置、市场、工具、状态）
- `search.go` (4.3K) - 文件搜索和替换功能
- `git.go` (3.1K) - Git 版本控制操作
- `terminal.go` (3.6K) - 终端管理
- `opencode.go` (7.9K) - OpenCode 服务管理
- `files.go` (9.3K) - 文件系统操作

### 剩余模块（当前在 app.go 中）
`app.go` (359 行) - **核心应用结构：**

1. **App 结构定义** (~50 行)
   - App 类型和初始化
   - 服务器 URL 管理

2. **文件运行功能** (~150 行)
   - RunFile 及相关辅助函数
   - 支持多种语言的运行配置
   - Maven/Gradle/Cargo 项目检测

3. **基础操作** (~159 行)
   - 终端管理代理函数
   - OpenCode 管理代理函数
   - 文件管理代理函数
   - 文件夹选择和工作目录管理
   - 文件操作（删除、重命名、复制、移动）

## 拆分成果

- ✅ **provider.go** - Provider 和配置 (61 行)
- ✅ **model.go** - 模型配置管理 (123 行)
- ✅ **session.go** - 会话管理 (541 行)
- ✅ **plugin.go** - 插件管理 (497 行)
- ✅ **mcp.go** - MCP 服务器管理 (618 行)

## 拆分效果

- **app.go 从 2146 行减少到 359 行**
- **减少了 83% 的代码量**
- **拆分出 5 个功能模块，共 1840 行**
- 所有模块编译通过 ✅
- 功能完整保持 ✅

## 剩余 app.go 分析

当前 app.go (359 行) 主要包含：
- **核心 App 结构** - 应用的基础框架
- **文件运行功能** - 多语言文件执行支持
- **代理函数** - 对其他模块的简单封装

这些代码已经相对精简，主要是核心功能和代理层，进一步拆分的价值不大。

## 拆分原则

1. **单一职责** - 每个文件只负责一个功能领域 ✅
2. **保持编译** - 拆分过程中确保代码能编译通过 ✅
3. **逐步迁移** - 一次拆分一个模块，测试后再继续 ✅
4. **避免循环依赖** - 保持清晰的依赖关系 ✅

## 验证

- ✅ 编译成功
- ✅ 所有模块功能完整
- ✅ 代码结构清晰，职责分明
- ✅ 大幅减少单文件复杂度
