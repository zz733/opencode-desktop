# 启动应用并查看日志

## 操作步骤

### 1. 重新启动应用

在终端中执行：

```bash
cd myapp
wails dev
```

### 2. 查看初始化日志

应用启动时，您应该在终端看到类似这样的输出：

```
=== 初始化 Kiro 账号管理器 ===
✓ 加密服务初始化完成
✓ 配置管理器创建完成
✓ 配置初始化完成
✓ 数据目录: /Users/xxx/.config/opencode/data
✓ 存储服务初始化完成
✓ 账号管理器初始化完成
✓ 已加载 0 个账号
=== Kiro 账号管理器初始化完成 ===
```

**重要**：请记录"已加载 X 个账号"这一行的数字。

### 3. 打开应用界面

应用启动后会自动打开浏览器窗口。

### 4. 打开 Kiro 账号管理

1. 点击左侧菜单的"设置"或"Kiro 账号"
2. 查看账号列表

### 5. 尝试添加账号

1. 点击"添加账号"按钮
2. 选择"Refresh Token"方式
3. 粘贴 Token：
   ```
   aorAAAAAGnLGQgY_JGCEaAu31zq9-VgAlp1em-13e_w6H4pNt4aq17R2Ot_1LNtlrZASD8jR6JKRg5NVUWG5HZRdgBkc0:MGUCMQCuOP9WeTpHKpyyFSo/Q6M0NDCBKOvnnkPq15udRiV6EsyXa5lDxb+beSdukMSZ7s4CMCcIfnOZwQkXyBtPAT5sFPQdyBl8iMDZv7VBM/3l99RKBeOVSGKbqtVU6aIAik539A
   ```
4. 点击"添加账号"

### 6. 查看终端日志

点击"添加账号"后，终端应该显示：

```
API 调用: AddKiroAccount (method=token)
→ addAccountByToken 开始
  Refresh Token 长度: 234
  创建 Kiro API 客户端...
  调用 RefreshKiroToken...
  ✓ Token 刷新成功
  调用 GetKiroUsageLimits...
  ✓ 配额信息获取成功
  转换为账号对象...
  账号邮箱: luuquanglucyrmsj@k25.huas.edu.vn
  订阅类型: free
  主配额: 0/50
  调用 AddAccount...
✓ 账号添加成功
```

### 7. 验证账号列表

添加成功后，再次查看账号列表，终端应该显示：

```
API 调用: GetKiroAccounts
✓ 返回 1 个账号
```

## 可能的错误情况

### 错误 1：account manager not initialized

如果看到：
```
✗ 错误: account manager not initialized
```

**原因**：初始化失败
**解决**：查看初始化日志，找出失败的步骤

### 错误 2：刷新 Token 失败

如果看到：
```
✗ 刷新 Token 失败: ...
```

**原因**：
- Token 已过期
- 网络连接问题
- API 服务不可用

**解决**：
1. 检查网络连接
2. 尝试获取新的 Refresh Token
3. 检查 API 是否可访问：
   ```bash
   curl -I https://prod.us-east-1.auth.desktop.kiro.dev
   ```

### 错误 3：获取配额信息失败

如果看到：
```
✗ 获取配额信息失败: ...
```

**原因**：Access Token 无效或 API 调用失败

**解决**：查看详细错误信息

### 错误 4：添加账号失败

如果看到：
```
✗ 添加账号失败: ...
```

**原因**：
- 账号已存在（邮箱重复）
- 存储失败（权限问题）

**解决**：
1. 检查是否已有相同邮箱的账号
2. 检查目录权限：
   ```bash
   ls -la ~/.config/opencode/data/
   ```

## 调试命令

### 查看数据文件

```bash
# 检查数据目录
ls -la ~/.config/opencode/data/

# 查看文件大小
du -h ~/.config/opencode/data/accounts.json.enc

# 查看修改时间
stat ~/.config/opencode/data/accounts.json.enc
```

### 查看进程

```bash
# 查看应用进程
ps aux | grep myapp

# 查看端口占用
lsof -i :34115
```

### 完整环境检查

```bash
cd myapp
./verify_kiro_setup.sh
```

## 预期的完整日志流程

```
=== 应用启动 ===
=== 初始化 Kiro 账号管理器 ===
✓ 加密服务初始化完成
✓ 配置管理器创建完成
✓ 配置初始化完成
✓ 数据目录: /Users/xxx/.config/opencode/data
✓ 存储服务初始化完成
✓ 账号管理器初始化完成
✓ 已加载 0 个账号
=== Kiro 账号管理器初始化完成 ===

[用户打开界面]

API 调用: GetKiroAccounts
✓ 返回 0 个账号

[用户点击添加账号]

API 调用: AddKiroAccount (method=token)
→ addAccountByToken 开始
  Refresh Token 长度: 234
  创建 Kiro API 客户端...
  调用 RefreshKiroToken...
  ✓ Token 刷新成功
  调用 GetKiroUsageLimits...
  ✓ 配额信息获取成功
  转换为账号对象...
  账号邮箱: luuquanglucyrmsj@k25.huas.edu.vn
  订阅类型: free
  主配额: 0/50
  调用 AddAccount...
✓ 账号添加成功

[前端自动刷新列表]

API 调用: GetKiroAccounts
✓ 返回 1 个账号
```

## 下一步

请按照上述步骤操作，并将终端的完整日志输出发给我，这样我就能准确定位问题所在。
