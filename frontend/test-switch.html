<!DOCTYPE html>
<html>
<head>
    <title>测试账号切换</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        button { padding: 10px 20px; margin: 10px; font-size: 16px; cursor: pointer; }
        .log { background: #f0f0f0; padding: 10px; margin: 10px 0; border-radius: 4px; }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
    <h1>账号切换测试</h1>
    
    <div>
        <button onclick="testGetAccounts()">1. 获取所有账号</button>
        <button onclick="testSwitch()">2. 切换到第一个账号</button>
        <button onclick="checkFile()">3. 检查配置文件</button>
    </div>
    
    <div id="output"></div>
    
    <script>
        function log(msg, type = 'info') {
            const div = document.createElement('div');
            div.className = 'log ' + type;
            div.textContent = new Date().toLocaleTimeString() + ' - ' + msg;
            document.getElementById('output').appendChild(div);
        }
        
        async function testGetAccounts() {
            try {
                log('正在获取账号列表...');
                const accounts = await window.go.main.App.GetKiroAccounts();
                log('成功！账号数量: ' + accounts.length, 'success');
                accounts.forEach((acc, i) => {
                    log(`账号 ${i+1}: ${acc.email} (ID: ${acc.id.substring(0, 8)}...)`, 'info');
                });
                window.testAccounts = accounts;
            } catch (error) {
                log('失败: ' + error, 'error');
            }
        }
        
        async function testSwitch() {
            try {
                if (!window.testAccounts || window.testAccounts.length === 0) {
                    log('请先点击"获取所有账号"', 'error');
                    return;
                }
                
                const account = window.testAccounts[0];
                log('正在切换到: ' + account.email);
                log('账号 ID: ' + account.id);
                
                await window.go.main.App.SwitchKiroAccount(account.id);
                
                log('切换成功！', 'success');
                log('请点击"检查配置文件"验证结果');
            } catch (error) {
                log('切换失败: ' + error, 'error');
            }
        }
        
        async function checkFile() {
            log('配置文件路径: ~/.config/opencode/kiro-accounts.json');
            log('请在终端运行: cat ~/.config/opencode/kiro-accounts.json | grep email');
        }
    </script>
</body>
</html>
